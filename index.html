<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.2/web3.min.js"></script>
    <script src="library.js" defer></script>
  </head>
  <body>
    <button id="btnGenerate">Create new wallet 造钱包</button><br />
    <a id="lblMnemonic"></a><br /><br />
    <button id="btnRandom">I have noted down 记下了</button>
    <button id="btnCont" disabled>Continue 继续</button><br />
    <div id="lblRandom"></div>
    <div id="lblCorrect"></div>
    <h1 id="lblSequence"></h1>
    Address 地址: <a id="lblAddress"></a><br /><br />
    Private Key 密钥: <a id="lblKey"></a><br /><br />
    <textarea id="txtImport"></textarea> <button id="btnImport">Import</button>
    <br /><a id="lblImport"></a>
  </body>
  <script defer>
    /*
    Call function to generate 24 mnemonic but truncate to 12 only
    调用函数生成 24 个助记词但只截断为 12 个
    */
    $('#btnGenerate').on('click', async function (event) {
      mnemonic = await walletGenerate();
      words = mnemonic.split(' ');
      $('#lblMnemonic').html(mnemonic);
      $('#lblKey').html(await walletKey(mnemonic));
      $('#lblAddress').html(getAddress($('#lblKey').html()));
    });
    /*
    I have memorised
    我记得了
    */
    $('#btnRandom').on('click', function (event) {
      genRanBtns(words, `#lblRandom`, `#lblCorrect`, `#btnCont`);
    });
    /*
    Check the mnemonic sequence
    检查助记词序列
    */
    function move(n, _div1, _div2, _btn) {
      n = $(`#btn${n}`);
      pos = n.parent().attr('id') == _div1.substring(1);
      n.detach().appendTo(pos ? _div2 : _div1);
      arr = $(_div2)
        .children()
        .map(function () {
          return $(this).html();
        })
        .get();
      $(_btn).prop(
        'disabled',
        arr.length == words.length &&
          arr.every(function (i, j) {
            return i === words[j];
          })
          ? false
          : true
      );
    }
    /*
    Private key to address
    地址的私钥
    */
    $('#btnImport').on('click', async function (event) {
      $('#lblImport').html(getAddress(await walletKey($('#txtImport').val())));
    });
    /*
    Private key to address
    地址的私钥
    */
    function getAddress(_key) {
      web3 = new Web3(window.ethereum);
      return web3.eth.accounts.privateKeyToAccount(_key).address;
    }
  </script>
</html>
